#include <stdio.h>

void extendedEuclid(__int128_t A, __int128_t B)
{
    __int128_t temp, x, y, d;
    if (B == 0)
    {
        d = A;
        x = 1;
        y = 0;
    }
    else
    {
        extendedEuclid(B, A % B);
        temp = x;
        x = y;
        y = temp - (A / B) * y;
    }
}

__int128_t mod_inv(__int128_t A, __int128_t M)
{
    __int128_t x;
    extendedEuclid(A, M);
    if (x < 0)
        x += M;
    return (x);
}

unsigned long long test(unsigned long long a)
{
    __asm__(
        ".intel_syntax noprefix\n"
        "mov rax, 0xe32abd8ee510e5b0\n"
        "xor rdi, rax\n"
        "mov rax, 0x9ad27faadfebecc6\n"
        "add     rdi, rax\n"
        "mov     rax, 0x85bacc51510eacc5\n"
        "add     rdi, rax\n"
        "mov     rax, 0x81e5c7a085394a9e\n"
        "or      rax, 0x1\n"
        "mul     rdi\n"
        "mov     rdi, rax\n"
        "neg     rdi\n"
        "inc     rdi\n"
        "dec     rdi\n"
        "mov     rax, 0xff3d70c0e7c45fa4\n"
        "sub     rdi, rax\n"
        "inc     rdi\n"
        "ror     rdi, 0x34\n"
        "mov     rax, 0xcfe2bba6546f26ba\n"
        "sub     rdi, rax\n"

        // debug
        "mov     rax, 0x70717b53945b0533\n"
        "or      rax, 0x1\n"
        "mul     rdi\n"
        "mov     rdi, rax\n"
        "inc     rdi\n"
        "inc     rdi\n"
        "mov     rax, 0x83763502def4110e\n"
        "xor     rdi, rax\n"
        "ror     rdi, 0x22\n"
        "mov     rax, 0x28eeaaf50204f378\n"
        "sub     rdi, rax\n"
        "inc     rdi\n"
        "rol     rdi, 0x15\n"
        "mov     rax, 0xf189292ec8ea0447\n"
        "or      rax, 0x1\n"
        "mul     rdi\n"
        "mov     rdi, rax\n"
        "mov     rax, 0x3040ab4220e78a60\n"
        "sub     rdi, rax\n"
        "mov     rax, 0xa4c7b23d20f526c2\n"
        "add     rdi, rax\n"
        "mov     rax, 0xbdef3b433857e2e9\n"
        "or      rax, 0x1\n"
        "mul     rdi\n"
        "mov     rdi, rax\n"
        // debug

        "neg     rdi\n"
        "inc     rdi\n"
        "neg     rdi\n"
        "ror     rdi, 0x2\n"
        "mov     rax, 0x201826a9a4e513f3\n"
        "xor     rdi, rax\n"
        "mov     rax, 0x60cd0371aebc755c\n"
        "xor     rdi, rax\n"
        "mov     rax, 0x935a9339ad02c74e\n"
        "sub     rdi, rax\n"
        "dec     rdi\n"
        "inc     rdi\n"
        "neg     rdi\n"
        "ror     rdi, 0x2a\n"
        "mov     rax, 0x530ce73ba46dcc81\n"
        "add     rdi, rax\n"
        "rol     rdi, 0x1\n"
        "neg     rdi\n"
        "mov     rax, 0x97bb086f22f2bcb1\n"
        "or      rax, 0x1\n"
        "mul     rdi\n"
        "mov     rdi, rax\n"
        "mov     rax, 0x83a79da815bee394\n"
        "xor     rdi, rax\n"
        "dec     rdi\n"
        "mov     rax, 0xf08b62cd30fb96b3\n"
        "sub     rdi, rax\n"
        "inc     rdi\n"
        "mov     rax, 0x7e9f6916bf02e6d3\n"
        "xor     rdi, rax\n"
        "ror     rdi, 0x7\n"
        "inc     rdi\n"
        "neg     rdi\n"
        "inc     rdi\n"
        "neg     rdi\n"
        "neg     rdi\n"
        "mov     rax, 0xb105067168dc7f06\n"
        "sub     rdi, rax\n"
        "inc     rdi\n"
        "mov     rax, 0x91334a5eb0f5a178\n"
        "add     rdi, rax\n"
        "inc     rdi\n"
        "mov     rax, 0x112e7fe34821799d\n"
        "or      rax, 0x1\n"
        "mul     rdi\n"
        "mov     rdi, rax\n"
        "inc     rdi\n"
        "dec     rdi\n"
        "mov     rax, 0x2a15aed18fe41ed7\n"
        "add     rdi, rax\n"
        "mov     rax, 0x43ed814a5e004aa8\n"
        "or      rax, 0x1\n"
        "mul     rdi\n"
        "mov     rdi, rax\n"
        "dec     rdi\n"
        "mov     rax, 0x8d1f03f5c091c60a\n"
        "or      rax, 0x1\n"
        "mul     rdi\n"
        "mov     rdi, rax\n"
        "dec     rdi\n"
        "mov     rax, 0x9ca079569fba3d98\n"
        "sub     rdi, rax\n"
        "dec     rdi\n"
        "mov     rax, 0xa91ee3d67d08df61\n"
        "xor     rdi, rax\n"
        "ror     rdi, 0x13\n"
        "dec     rdi\n"
        "mov     rax, 0x8acec90559634779\n"
        "or      rax, 0x1\n"
        "mul     rdi\n"
        "mov     rdi, rax\n"
        "ror     rdi, 0x11\n"
        "dec     rdi\n"
        "neg     rdi\n"
        "mov     rax, 0xd15a94f1417dca7c\n"
        "add     rdi, rax\n"
        "dec     rdi\n"
        "ror     rdi, 0x5\n"
        "mov     rax, 0x8033c1531b145730\n"
        "sub     rdi, rax\n"
        "inc     rdi\n"
        "rol     rdi, 0x3e\n"
        "neg     rdi\n"
        "mov     rax, 0xb3a9674ea97a7668\n"
        "sub     rdi, rax\n"
        "dec     rdi\n"
        "mov     rax, 0x972878f59896cb1c\n"
        "xor     rdi, rax\n"
        "dec     rdi\n"
        "inc     rdi\n"
        "mov     rax, 0x8963f17b52a0824c\n"
        "add     rdi, rax\n"
        "mov     rax, 0x448d4b4c0c2c4af5\n"
        "sub     rdi, rax\n"
        "mov     rax, 0x12df6acc8af52da8\n"
        "sub     rdi, rax\n"
        "mov     rax, 0x765f83d671121c39\n"
        "sub     rdi, rax\n"
        "neg     rdi\n"
        "mov     rax, 0x3896eb4aa7789878\n"
        "add     rdi, rax\n"
        "inc     rdi\n"
        "inc     rdi\n"
        "mov     rax, 0x483429977c450318\n"
        "xor     rdi, rax\n"
        "inc     rdi\n"
        "inc     rdi\n"
        "ror     rdi, 0x1b\n"
        "inc     rdi\n"
        "neg     rdi\n"
        "mov     rax, 0x6dad8fcf4fa51901\n"
        "sub     rdi, rax\n"
        "inc     rdi\n"
        "ror     rdi, 0x5\n"
        "mov     rax, 0xa860153b86c8cae2\n"
        "xor     rdi, rax\n"
        "mov rax, 0xdc18545ac996448a\n"
        "xor     rax, rdi\n"
        ".att_syntax\n");
}

unsigned long long rev()
{
    __asm(
        ".intel_syntax noprefix\n"
        "mov    rdi, 0xdc18545ac996448a\n"
        "mov    rax, 0xa860153b86c8cae2\n"
        "xor    rdi, rax\n"
        "rol    rdi, 0x5\n"
        "dec    rdi\n"
        "mov    rax, 0x6dad8fcf4fa51901\n"
        "add    rdi, rax\n"
        "neg    rdi\n"
        "dec    rdi\n"
        "rol    rdi, 0x1b\n"
        "dec    rdi\n"
        "dec    rdi\n"
        "mov    rax, 0x483429977c450318\n"
        "xor    rdi, rax\n"
        "dec    rdi\n"
        "dec    rdi\n"
        "mov    rax, 0x3896eb4aa7789878\n"
        "sub    rdi, rax\n"
        "neg    rdi\n"
        "mov    rax, 0x765f83d671121c39\n"
        "add    rdi, rax\n"
        "mov    rax, 0x12df6acc8af52da8\n"
        "add    rdi, rax\n"
        "mov    rax, 0x448d4b4c0c2c4af5\n"
        "add    rdi, rax\n"
        "mov    rax, 0x8963f17b52a0824c\n"
        "sub    rdi, rax\n"
        "mov    rax, 0x972878f59896cb1c\n"
        "xor    rdi, rax\n"
        "inc    rdi\n"
        "mov    rax, 0xb3a9674ea97a7668\n"
        "add    rdi, rax\n"
        "neg    rdi\n"
        "ror    rdi, 0x3e\n"
        "dec    rdi\n"
        "mov    rax, 0x8033c1531b145730\n"
        "add    rdi, rax\n"
        "rol    rdi, 0x5\n"
        "inc    rdi\n"
        "mov    rax, 0xd15a94f1417dca7c\n"
        "sub    rdi, rax\n"
        "neg    rdi\n"
        "inc    rdi\n"
        "rol    rdi, 0x11\n"
        "mov    rax, 0x7bd2b00041c172c9\n"
        "mul    rdi\n"
        "mov    rdi, rax\n"
        "inc    rdi\n"
        "rol    rdi, 0x13\n"
        "mov    rax, 0xa91ee3d67d08df61\n"
        "xor    rdi, rax\n"
        "inc    rdi\n"
        "mov    rax, 0x9ca079569fba3d98\n"
        "add    rdi, rax\n"
        "inc    rdi\n"
        "mov    rax, 0xe6efb7b8afd015a3\n"
        "mul    rdi\n"
        "mov    rdi, rax\n"
        "inc    rdi\n"
        "mov    rax, 0x471c061e8dadf999\n"
        "mul    rdi\n"
        "mov    rdi, rax\n"
        "mov    rax, 0x2a15aed18fe41ed7\n"
        "sub    rdi, rax\n"
        "mov    rax, 0x8b7a97314f6bd4b5\n"
        "mul    rdi\n"
        "mov    rdi, rax\n"
        "dec    rdi\n"
        "mov    rax, 0x91334a5eb0f5a178\n"
        "sub    rdi, rax\n"
        "dec    rdi\n"
        "mov    rax, 0xb105067168dc7f06\n"
        "add    rdi, rax\n"
        "dec    rdi\n"
        "neg    rdi\n"
        "dec    rdi\n"
        "rol    rdi, 0x7\n"
        "mov    rax, 0x7e9f6916bf02e6d3\n"
        "xor    rdi, rax\n"
        "dec    rdi\n"
        "mov    rax, 0xf08b62cd30fb96b3\n"
        "add    rdi, rax\n"
        "inc    rdi\n"
        "mov    rax, 0x83a79da815bee394\n"
        "xor    rdi, rax\n"
        "mov    rax, 0x3a5c30a7e47a0c51\n"
        "mul    rdi\n"
        "mov    rdi, rax\n"
        "neg    rdi\n"
        "ror    rdi, 0x1\n"
        "mov    rax, 0x530ce73ba46dcc81\n"
        "sub    rdi, rax\n"
        "rol    rdi, 0x2a\n"
        "neg    rdi\n"
        "mov    rax, 0x935a9339ad02c74e\n"
        "add    rdi, rax\n"
        "mov    rax, 0x60cd0371aebc755c\n"
        "xor    rdi, rax\n"
        "mov    rax, 0x201826a9a4e513f3\n"
        "xor    rdi, rax\n"
        "rol    rdi, 0x2\n"
        "neg    rdi\n"
        "dec    rdi\n"
        "neg    rdi\n"
        // debug
        "mov    rax, 0x329038d57e0d1559\n"
        "mul    rdi\n"
        "mov    rdi, rax\n"
        "mov    rax, 0xa4c7b23d20f526c2\n"
        "sub    rdi, rax\n"
        "mov    rax, 0x3040ab4220e78a60\n"
        "add    rdi, rax\n"
        "mov    rax, 0x8ce8d63de8386577\n"
        "mul    rdi\n"
        "mov    rdi, rax\n"
        "ror    rdi, 0x15\n"
        "dec    rdi\n"
        "mov    rax, 0x28eeaaf50204f378\n"
        "add    rdi, rax\n"
        "rol    rdi, 0x22\n"
        "mov    rax, 0x83763502def4110e\n"
        "xor    rdi, rax\n"
        "dec    rdi\n"
        "dec    rdi\n"
        "mov    rax, 0x3ef9891811e87dfb\n"
        "mul    rdi\n"
        "mov    rdi, rax\n"
        // debug
        "mov    rax, 0xcfe2bba6546f26ba\n"
        "add    rdi, rax\n"
        "rol    rdi, 0x34\n"
        "dec    rdi\n"
        "mov    rax, 0xff3d70c0e7c45fa4\n"
        "add    rdi, rax\n"
        "neg    rdi\n"
        "mov    rax, 0x1289bacaae3f515f\n"
        "mul    rdi\n"
        "mov    rdi, rax\n"
        "mov    rax, 0x85bacc51510eacc5\n"
        "sub    rdi, rax\n"
        "mov    rax, 0x9ad27faadfebecc6\n"
        "sub    rdi, rax\n"
        "mov    rax, 0xe32abd8ee510e5b0\n"
        "xor    rdi, rax\n"
        "mov    rax, rdi\n"
        ".att_syntax\n");
}

unsigned long long rev2()
{
    __asm(
        ".intel_syntax noprefix\n"
        "mov rax, 0x8a287260996d5202\n"
        "xor rax, rdi\n"
        "mov rax, 0x4e5a56797b297edf\n"
        "xor rdi, rax\n"
        "mov rax, 0xdb79fd628a530746\n"
        "add rdi, rax\n"
        "mov rax, 0x5111f76c6baeda8f\n"
        "mul rdi\n"
        "mov rdi, rax\n"
        "mov rax, 0x223f3bf59869d640\n"
        "add rdi, rax\n"
        "ror rdi, 0x15\n"
        "mov rax, 0x31c4cf6920b0b07c\n"
        "sub rdi, rax\n"
        "rol rdi, 0x3\n"
        "rol rdi, 0x2a\n"
        "rol rdi, 0x1c\n"
        "mov rax, 0x659f60b46e69120b\n"
        "mul rdi\n"
        "mov rdi, rax\n"
        "mov rax, 0x1c3860b899e9999b\n"
        "xor rdi, rax\n"
        "neg rdi\n"
        "rol rdi, 0x2a\n"
        "dec rdi\n"
        "rol rdi, 0x32\n"
        "inc rdi\n"
        "ror rdi, 0xb\n"
        "rol rdi, 0x2a\n"
        "mov rax, 0x7025403d5f70047a\n"
        "xor rdi, rax\n"
        "inc rdi\n"
        "mov rax, 0x32e499f9b07ddb5c\n"
        "sub rdi, rax\n"
        "rol rdi, 0xc\n"
        "mov rax, 0xc17004d4f19fe299\n"
        "add rdi, rax\n"
        "mov rax, 0x2a130ad795b05bca\n"
        "sub rdi, rax\n"
        "dec rdi\n"
        "mov rax, 0x59a5dc816ca6da05\n"
        "add rdi, rax\n"
        "mov rax, 0x8477e3cfc96e2d05\n"
        "sub rdi, rax\n"
        "neg rdi\n"
        "mov rax, 0xef0c9619b6d1b93e\n"
        "add rdi, rax\n"
        "mov rax, 0x903f985ae32f77e4\n"
        "add rdi, rax\n"
        "ror rdi, 0x1e\n"
        "neg rdi\n"
        "mov rax, 0x9c1e02747ad997f3\n"
        "xor rdi, rax\n"
        "ror rdi, 0x3d\n"
        "mov rax, 0x469462ff1d3b2f31\n"
        "sub rdi, rax\n"
        "mov rax, 0xcd1216293ee86867\n"
        "xor rdi, rax\n"
        "mov rax, 0x5c6fbd8f5e3e67e1\n"
        "mul rdi\n"
        "mov rdi, rax\n"
        "inc rdi\n"
        "neg rdi\n"
        "neg rdi\n"
        "mov rax, 0x3d70db5a9213a8af\n"
        "mul rdi\n"
        "mov rdi, rax\n"
        "mov rax, 0xc7b78a98f31775d2\n"
        "xor rdi, rax\n"
        "dec rdi\n"
        "dec rdi\n"
        "neg rdi\n"
        "rol rdi, 0x25\n"
        "inc rdi\n"
        "rol rdi, 0x9\n"
        "mov rax, 0x2b9c5395c770f763\n"
        "sub rdi, rax\n"
        "mov rax, 0x33efc45be7c0af1d\n"
        "add rdi, rax\n"
        "neg rdi\n"
        "neg rdi\n"
        "ror rdi, 0xd\n"
        "rol rdi, 0xc\n"
        "mov rax, 0x21acc97912f41e15\n"
        "xor rdi, rax\n"
        "mov rax, 0xed10c2ce0efe30fa\n"
        "xor rdi, rax\n"
        "dec rdi\n"
        "neg rdi\n"
        "dec rdi\n"
        "mov rax, 0x40f1f5ed0df43237\n"
        "mul rdi\n"
        "mov rdi, rax\n"
        "rol rdi, 0x33\n"
        "inc rdi\n"
        "inc rdi\n"
        "neg rdi\n"
        "ror rdi, 0x22\n"
        "inc rdi\n"
        "neg rdi\n"
        "inc rdi\n"
        "inc rdi\n"
        "mov rax, 0x189d27070f20a167\n"
        "mul rdi\n"
        "mov rdi, rax\n"
        "mov rax, 0x5fca8b4306e3d384\n"
        "add rdi, rax\n"
        "mov rax, 0x3a17d7879f4092e6\n"
        "xor rdi, rax\n"
        "dec rdi\n"
        "inc rdi\n"
        "neg rdi\n"
        "mov rax, 0x4368ca6aebaaebb5\n"
        "sub rdi, rax\n"
        "rol rdi, 0xb\n"
        "neg rdi\n"
        "neg rdi\n"
        "ror rdi, 0x18\n"
        "mov rax, 0xb6c66ef3f155ba3f\n"
        "mul rdi\n"
        "mov rdi, rax\n"
        "mov rax, 0xb2ee3cf2d40abd83\n"
        "sub rdi, rax\n"
        "dec rdi\n"
        "mov rax, 0xdb28e6fb3e9ecc44\n"
        "xor rdi, rax\n"
        "mov rax, 0xb7e8f185f1157d41\n"
        "mul rdi\n"
        "mov rdi, rax\n"
        "neg rdi\n"
        "inc rdi\n"
        "rol rdi, 0x11\n"
        "mov rax, 0x5cc5a5ef65088852\n"
        "add rdi, rax\n"
        "mov rax, 0xe6be9a7de8b533fa\n"
        "sub rdi, rax\n"
        "dec rdi\n"
        "dec rdi\n"
        "mov rax, 0xad85a09631290114\n"
        "sub rdi, rax\n"
        "mov rax, 0x6a8566328abf0feb\n"
        "mul rdi\n"
        "mov rdi, rax\n"
        "dec rdi\n"
        "mov rax, 0xe21c00c980f8507c\n"
        "add rdi, rax\n"
        "inc rdi\n"
        "mov rax, 0x610aa1c5c8a0c1b3\n"
        "mul rdi\n"
        "mov rdi, rax\n"
        "ror rdi, 0x32\n"
        "mov rax, 0xec3c68cfeabdd10f\n"
        "add rdi, rax\n"
        "mov rax, rdi\n"
        ".att_syntax\n");
}

int main()
{
    printf("rev1: %llu\n", rev());
    printf("test1: %llu\n", test(rev()));

    printf("rev2: %llu\n", rev2());
    return 0;
}